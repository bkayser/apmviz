---
title: "Intro"
author: "Bill Kayser"
date: "March 3, 2016"
#runtime: shiny
output: 
  ioslides_presentation: 
    css: ./styles.css
    keep_md: yes
    logo: images/logo_text.png
    smaller: yes
    widescreen: yes
---

```{r init_intro, echo=F, message=F, warning=F}
source('init.R')
```

## Bill Kayser

<img class='left' src='./images/logo_square.png' width='20%'/>

* Founding engineer at New Relic
* Software architect specializing in web applications
* Working in APM for 10 years
* Data Science, Machine Learning, and Visualization

<div class="notes">

My name is Bill Kayser and I am a Data Nerd.

I think about data all the time.  I think about web applications, the data that we use to measure them, 
and the way we visualize that data.

Maybe you think a lot about data too.  And if you're like me, you even dream in data.  

I also think a lot about soccer.

</div>

## Data and Soccer

<div class="notes">
Here's a box score from a soccer match.  Until pretty recently this
was about all you would get from a soccer match.  As a data nerd this interests me 
but as a soccer fan I want to know more.  I want to dig deeper.

Now as with everything else we can collect much more data, and we have the opportunity
to gain completely new insight from the game.  

</div>

**Boxscore Image**

## Data and Soccer

<div class="notes">
This is what soccer games look like now for me when I dream of data.  

This is really what I want from data.  Not just meaningful statistics but a way to present
them that adds new dimensions to your understanding of the thing.


The world runs on software and we use data to measure and understand 
how our applications are doing.  But mostly we're locked into traditional statistics and
charts for understanding what's going on.  Today I'm going to try to tease apart all
the different metrics that we collect and present some new ways of visualizing performance
as well as some alternative metrics we can use to improve the fidelity.

So let's go through some examples.

</div>

** Super cool charts **

## Congratulations!

<img class='graphic tall' src='./images/apollo_congrats.jpg'/>

## Now what?

<img class='graphic tall' src='./images/whatsnext.jpg'/>

<div class="notes">

There's a lot of information you need access to in order to serve your customers.
For the purposes of this talk, let's just focus this on how well your site is serving 
your customers.  You want to find out what the user experience is like.  You want to get a sense of 
the best and worst case as well as the variance.  You also want to know how your application
responds to changes in load, whether it's trending up or trending down, and where you 
are having problems.

For this talk I'm going to focus on the response time of web applications.

</div>

## What's the average time to service a request?

```{r microservicedata, fig.height=3}

rt <- stri_c(round(microservice$summary$mean), " ms.")

g_text <- ggplot() + 
    annotate("text", label=rt, x=0.5, y=0.5, size=40) + 
    blank_theme +
    theme(panel.background=element_rect(fill='white'))
g_text

```

<h3 class='center'>All good? </h3>

## Maybe this will help

```{r easy, fig.height=4}
g_button <- ggplot() + aes(x=0, y=0) + 
    geom_point(size=80, colour='#AAAAAA', show.legend = F) +
    geom_point(size=70, colour='green', alpha=0.4, show.legend = F) +
    xlim(c(-1,1)) +  ylim(c(-1, 1)) +
    blank_theme 

g_button +  geom_text(aes(x=0, y=0), nudge_y=-1, label=rt, size=18, vjust='bottom') 

```


##

<img class='face' src='images/obama-frown.jpg'/>

## Lets look at recent history

```{r mean}
summary_plot(filter(microservice$plotlines, measure=='mean'))
```

## Median 

```{r median}
summary_plot(filter(microservice$plotlines, measure %in% c('mean', 'median'))) 
```

## Quartiles, 25% and 75%

```{r percentiles_low}
g_quartiles <- summary_plot(filter(microservice$plotlines, measure %in% c('mean', 'median', 'q25', 'q75')))
g_quartiles 
```

##

<img class='face' src='images/obama-maybe.jpg'/>

## ...95% and 99%

```{r percentiles_all}
summary_plot(filter(microservice$plotlines, measure %in% c('mean', 'median', 'q25', 'q75', 'q95', 'q99')))
```

## Throughput

```{r throughput}
g_throughput <- summary_plot(filter(microservice$plotlines, measure == 'throughput')) +
              my_plot_theme + theme('legend.position'='none') +
              ylab('Throughput')

multiplot(g_quartiles + theme('legend.position'='none') + ylab('Summary Measures'), 
          g_throughput)
          
```

## Are we really getting the information we need?  

### What's missing?

## Histograms

```{r hist1, warning=F}

g_hist <- ggplot(microservice$events, aes(x=value)) + xlim(0, microservice$xlimit) +
    geom_histogram(bins=120, fill='gray', color='lightgray') +
    my_plot_theme +
    summary_colorscale +
    summary_linescale +
   legend_right

g_hist

```


## Histograms

```{r hist2, warning=F}

g_hist + geom_vline(aes(xintercept=microservice$summary$mean, color='mean', linetype='mean'), size=1.2) 

```

## Histogram with Summary Values  

```{r hist3, warning=F}
summary_data <- data.frame(measure=names(microservice$summary), value=unlist(microservice$summary)) %>%
    filter(measure != 'sd' & measure != 'score')

g_hist_complete <- g_hist +
    geom_vline(data=summary_data,      
               aes(xintercept=value, color=measure, linetype=measure),
               size=1.2) 
g_hist_complete

```

## Combining Histogram with Timeseries

```{r}
clean_theme <- theme(legend.position='none',
                     axis.title.x=element_blank(),
                     axis.text=element_blank())

multiplot(g_hist_complete + clean_theme, 
          g_quartiles + clean_theme + ylab('Summary Measures'),
          g_throughput + clean_theme)
```


## Scatterplot of Each Request

```{r raw}
(g_scatter <- scatterplot(microservice))
```

##

<img class='face' src='images/obama-yes.jpg'/>


## Combine Scatterplot and Summary

```{r rawplus}

add_plotlines(g_scatter, microservice, c('mean','median', 'q25', 'q75'))

```

## All the Things

```{r everything}

multiplot(cols=3,
          ggplot() +  annotate("text", 
                               label=stri_c(round(mean(microservice$events$value)), " ms."), 
                               x=0.5, y=0.5, size=16) + blank_theme,
          g_button,
          g_quartiles+ theme(legend.position='none'),
          g_throughput+ theme(legend.position='none'),
          g_hist_complete+ theme(legend.position='none'),
          g_scatter+ theme(legend.position='none'))
```
